---
title: "36-613 Group EDA Rough Draft, Fall 2025"
author: 
- "Vaibhav Jha, Alex Hill, Avery Wang"
subtitle: "Due Wednesday, September 24 by 11:59pm"
format:
  pdf:
    colorlinks: true
---

```{r setup, include=F}
library(tidyverse)
knitr::opts_chunk$set(echo = FALSE)
```

```{r Read Files}
linkedin <- read.csv("linkedin.csv")
companies <- read.csv("companies/companies_new.csv")
job_industries <- read.csv("jobs/job_industries_new.csv")
company_specialities <- read.csv("companies/company_specialities.csv")
employee_counts <- read.csv("companies/employee_counts_new.csv")
```

```{r Most popular industries in job postings}
# Most popular industries in job postings
job_industries |>
  group_by(industry_name) |>
  summarize(count = n()) |>
  slice_max(count, n = 20) |>
  ggplot(aes(x = fct_reorder(industry_name, count), y = count, fill = fct_reorder(industry_name, count))) +
  geom_bar(stat = "identity") +
  guides(x = guide_axis(angle = 45)) +
  theme(legend.position = "none") +
  labs(
    x = "Industry",
    y = "Number of Job Postings",
    title = "Industries with the Most Job Postings"
  )
```

```{r Most companies in each industry}
companies |>
  group_by(industry) |>
  summarize(count = n()) |>
  slice_max(count, n = 20) |>
  ggplot(aes(x = fct_reorder(industry, count), y = count, fill = fct_reorder(industry, count))) +
  geom_bar(stat = "identity") +
  guides(x = guide_axis(angle = 45)) +
  theme(legend.position = "none") +
  labs(
    x = "Industry",
    y = "Number of Companies",
    title = "Industries with the Most Companies"
  )
```

```{r Companies with most applications}
# Looks like the places with the most job postings are recruiting places, probably not what we're looking for

linkedin |>
  group_by(company_name) |>
    # Remove postings with no company name or unknown number of apps
  filter(company_name != "") |>
  drop_na(applies) |>
  summarize(applications = sum(applies)) |>
  slice_max(applications, n = 20) |>
  ggplot(aes(x = fct_reorder(company_name, applications), y = applications, fill = fct_reorder(company_name, applications))) +
  geom_bar(stat = "identity") +
  guides(x = guide_axis(angle = 45)) +
  theme(legend.position = "none") +
  labs(
    x = "Company",
    y = "Number of Total Job Applications",
    title = "Companies with the Most Job Applications"
  )
```

```{r Select top industries}
top_industries <- c(
  "IT Services and IT Consulting",
  "Hospitals and Health Care",
  "Software Development",
  "Financial Services"
)

# Jobs only in top industries, one row per job
good_job_industries <- job_industries |>
  filter(industry_name %in% top_industries) |>
  mutate(dummy = 1) |>
  pivot_wider(
    names_from = industry_name,
    values_from = dummy,
    values_fill = 0
  ) |>
  group_by(job_id) |>
  mutate(
    `IT Services and IT Consulting` = sum(`IT Services and IT Consulting`),
    `Hospitals and Health Care` = sum(`Hospitals and Health Care`),
    `Software Development` = sum(`Software Development`),
    `Financial Services` = sum(`Financial Services`)
  ) |>
  select(-X) |>
  distinct()

# Get the most recent employee counts for each company
recent_employee_counts <- employee_counts |>
  group_by(company_id) |>
  slice_max(time_recorded, n = 1) |>
  select(-X)

# Join industries and employee counts to LinkedIn, do inner join to keep only good jobs and companies in the database
good_linkedin <- linkedin |>
  inner_join(good_job_industries, by = "job_id") |>
  inner_join(recent_employee_counts, by = "company_id") |>
  # Filter more than 100 apps and more than 0 employees
  filter(applies > 100) |>
  filter(employee_count > 0)
```

```{r Number of Applications vs. Employee Counts, fig.width=8, fig.height=6}
library(gridExtra)

plot1 <- good_linkedin |>
  ggplot(aes(x = employee_count, y = applies, color = as.factor(`IT Services and IT Consulting`))) +
  geom_point() +
  scale_x_log10() +
  labs(
    x = "Employee Count",
    y = "Number of Applications",
    color = "IT Services and\nIT Consulting"
  )

plot2 <- good_linkedin |>
  ggplot(aes(x = employee_count, y = applies, color = as.factor(`Hospitals and Health Care`))) +
  geom_point() +
  scale_x_log10() +
  labs(
    x = "Employee Count",
    y = "Number of Applications",
    color = "Hospitals and\nHealth Care"
  )

plot3 <- good_linkedin |>
  ggplot(aes(x = employee_count, y = applies, color = as.factor(`Software Development`))) +
  geom_point() +
  scale_x_log10() +
  labs(
    x = "Employee Count",
    y = "Number of Applications",
    color = "Software \nDevelopment"
  )

plot4 <- good_linkedin |>
  ggplot(aes(x = employee_count, y = applies, color = as.factor(`Financial Services`))) +
  geom_point() +
  scale_x_log10() +
  labs(
    x = "Employee Count",
    y = "Number of Applications",
    color = "Financial\nServices"
  )

grid.arrange(plot1, plot2, plot3, plot4, ncol = 2, nrow = 2)
```

```{r}
good_linkedin_summary <- good_linkedin |>
  group_by(
    company_name,
    employee_count,
    follower_count,
    `IT Services and IT Consulting`,
    `Hospitals and Health Care`,
    `Software Development`,
    `Financial Services`) |>
  summarize(applications = sum(applies)) |>
  ungroup() |>
  
  group_by(company_name) |>
  mutate(
    `IT Services and IT Consulting` = sum(`IT Services and IT Consulting`),
    `Hospitals and Health Care` = sum(`Hospitals and Health Care`),
    `Software Development` = sum(`Software Development`),
    `Financial Services` = sum(`Financial Services`),
    applications = sum(applications)
  ) |>
  distinct()

good_linkedin_summary |>
  ggplot(aes(x = employee_count, y = applications)) +
  geom_point() +
  scale_x_log10() +
  labs(
    x = "Employee Count", 
    y = "Total Number of Applications"
  )

good_linkedin_summary |>
  ggplot(aes(x = follower_count, y = applications)) +
  geom_point() +
  scale_x_log10() +
  labs(
    x = "Follower Count", 
    y = "Total Number of Applications"
  )
```